###QEMU SETUP

# Repo-local workdir (portable between 42 and Arch Setup) 
if [ -z "${WORKDIR:-}" ]; then
    case "$0" in 
        */install-vm.sh|install-vm.sh )
            _wd="$(cd "$(dirname "$0")" 2>/dev/null && pwd || pwd)"
            ;;
        *)
            _wd="$(pwd)"
            ;;
    esac
    WORKDIR="$_wd"
fi

# Files & sizes
ISO_NAME="debian-13.1.0-amd64-netinst.iso"
ISO_URL="https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/${ISO_NAME}"
DISK_NAME="debian.qcow2"
DISK_SIZE="20G"
RAM_SIZE="2048"

_arte_user="${USER:-oleg}"
_arte_42="$HOME/sgoinfre/$_arte_user"
if [ -d "$_arte_42" ] && [ -w "$_arte_42" ]; then
    _ARTEFACTS_BASE="$_arte_42"
else
    _ARTEFACTS_BASE="$WORKDIR"
fi

# Artefacts Location
: "${IMAGES_DIR:=${_ARTEFACTS_BASE}/images}"
: "${LOGS_DIR:=${_ARTEFACTS_BASE}/Logs}"

# Point to local QEMU builds (e.g., in ~/goinfre/qemu/bin at 42 for example)
QEMU_SYSTEM_BIN="${QEMU_SYSTEM_BIN:-qemu-system-x86_64}"
QEMU_IMG_BIN="${QEMU_IMG_BIN:-qemu-img}"

# Accel policy (CPU): auto | kvm | tcg (auto=detect /dev/kvm)
ACCEL_POLICY="${ACCEL_POLICY:-auto}"

# UI policy (display)
UI_POLICY="${UI_POLICY:-auto}"

# Audio policy 
AUDIO_POLICY="${AUDIO_POLICY:-off}"

# Save generated credentials to Logs/vm-credentials.txt (1=yes, 0=no)
SAVE_CREDENTIALS="${SAVE_CREDENTIALS:-1}"

# Networking forwards (user-mode NAT)
SSH_HOST_PORT="${SSH_HOST_PORT:-2222}"
HTTP_HOST_PORT="${HTTP_HOST_PORT:-8080}"
HTTPS_HOST_PORT="${HTTPS_HOST_PORT:-8443}"
ADMINER_HOST_PORT="${ADMINER_HOST_PORT:-9090}"
